{"version":3,"sources":["common.js"],"names":["DOMAIN","API","SMART_ROUT_INFO","SEARCH_SMART_ROUT","SMART_ROUT","STATIC_ROUT_INFO","STATIC_ROUT","ALL_TYPE_INFO","ROUT","ACCOUNT_INFO","CHANNEL_INFO","CHANNEL_ITEM","QUERY_INFO_CHANGE","QUERY_ITEM_CHANNEL","QUERY_FEES_INFO","QUERY_FEE_ITEM","SAVE_CHANGE_INFO","DUMMY","WUI","init","options","config","system","locale","initSiteHeader","resp","SiteHeader","create","$el","$","name","aasUserPrincipal","ssoUserName","roles","aasUserResources","roleName","List","resources","sso","filterMenus","menus","i","length","resource","resourceType","isLeaf","linkUrl","subs","push","findParent","result","parentLevelStructure","levelStructure","initSiteMenu","multiMenus","isHome","window","location","href","indexOf","menuResources","index","menuResource","parent","linkUr","isActive","newPage","address","level","split","j","sub","console","log","replaceWith","templates","initConfigInfo","initSiteFooter","getResource","url","a","la","pathname","_link","info","initSystem","data","ajax","method","done","userName","AdminLTE","ready","error","typeItem","list","map","item","codeType"],"mappings":"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","file":"common.js","sourcesContent":["var DOMAIN = '';\n\nvar API = {\n  SMART_ROUT_INFO: DOMAIN + '/upp/web/v1/routes', // 获取全部智能路由接口\n  SEARCH_SMART_ROUT: DOMAIN + '/upp/web/v1/feeRoute', //查询一条智能路由\n  SMART_ROUT: DOMAIN + '/upp/web/v1/route', //智能路由\n  STATIC_ROUT_INFO: DOMAIN + '/upp/web/v1/staticRoutes', // 获取全部静态路由接口\n  STATIC_ROUT: DOMAIN + '/upp/web/v1/staticRoute', //静态路由接口\n  ALL_TYPE_INFO: DOMAIN + '/upp/web/v1/allCodetables', //获取全部的类型接口\n  ROUT: DOMAIN + '/upp/web/v1/route', //路由\n  ACCOUNT_INFO: DOMAIN + '/upp/web/v1/accounts', //本方账户信息\n  CHANNEL_INFO: DOMAIN + '/upp/web/v1/channelAbilitys',//查询通道信息\n  CHANNEL_ITEM: DOMAIN + '/upp/web/v1/channelAbility',//查询单挑通道信息\n  QUERY_INFO_CHANGE: DOMAIN + '/upp/web/v1/uppTodos',//查询信息变更\n  QUERY_ITEM_CHANNEL: DOMAIN + '/upp/web/v1/maintainDetail', //查询单条通道信息\n  QUERY_FEES_INFO: DOMAIN + '/upp/web/v1/channelFees',//查询所有计费信息\n  QUERY_FEE_ITEM: DOMAIN + '/upp/web/v1/channelFee',//查询单个计费信息\n  SAVE_CHANGE_INFO: DOMAIN + '/upp/web/v1/uppTodo' //保存审核信息\n};\n\nAPI.DUMMY = '';\n\n//var WUI = window.WUI || {};\n\nWUI.init = function (options) {\n  // init global config\n  WUI.config = WUI.config || {};\n  WUI.config.system = options.system;\n  WUI.config.locale = options.locale || 'zh-CN';\n\n  var initSiteHeader = function (resp) {\n    WUI.SiteHeader.create({\n      $el: $('.main-header'),\n      name: resp.aasUserPrincipal.ssoUserName,\n      roles: resp.aasUserPrincipal.aasUserResources.roles ? resp.aasUserPrincipal.aasUserResources.roles[0].roleName : '',\n      List : resp.aasUserPrincipal.aasUserResources.resources,\n      sso : resp.aasUserPrincipal\n    })\n  };\n\n  var filterMenus = function(resources) {\n    var menus = [];\n\n    for (var i = 0; i < resources.length; i++) {\n      var resource = resources[i];\n\n      if (resource.resourceType === 'menu') {\n        if (resource.isLeaf === '0') {\n          resource.linkUrl = 'javascript:void(0);';\n          resource.subs = [];\n        }\n        menus.push(resource);\n      }\n    }\n\n    return menus;\n  };\n\n  var findParent = function (resource, resources) {\n    var result = null;\n\n    if (resource.parentLevelStructure) {\n      for (var i = 0; i < resources.length; i++) {\n        if (resources[i].levelStructure === resource.parentLevelStructure) {\n          result = resources[i];\n          break;\n        }\n      }\n    }\n\n    return result;\n  }\n\n  var initSiteMenu = function (resp) {\n    var menus = [];\n    var multiMenus = false;\n    var resources = resp.aasUserPrincipal.aasUserResources.resources;\n    // 首页是为子系统单独添加的，没有放入后台做管理\n    var isHome = window.location.href.indexOf(WUI.config.system + '/home.html') >= 0;\n\n    if (WUI.config.system === 'order') {\n      // 工单系统四级菜单结构如：1.2.3.4.5 (第一位为子系统)\n      multiMenus = true;\n      var menuResources = filterMenus(resources);\n\n      for (var index = 0; index < menuResources.length; index++) {\n        var menuResource = menuResources[index];\n        var parent = findParent(menuResource, menuResources);\n\n        if (!isHome && window.location.href.indexOf(menuResource.linkUr) >= 0) {\n          menuResource.isActive = true;\n        }\n\n        if (parent) {\n          parent.subs.push(menuResource);\n        } else {\n          menus.push(menuResource);\n        }\n      }\n    } else {\n      // 统一系统二级菜单结构如：1.2.3 (第一位为子系统)\n      for (var i = 0; i < resources.length; i++) {\n        var resource = resources[i];\n        if (resource.linkUrl && resource.linkUrl.indexOf('trade-monitor') > 0) {\n          resource.newPage = true;\n        }\n        if (resource.resourceType === 'menu') {\n          var linkUrl = resource.linkUrl;\n          var address = window.location.href;\n\n          if (!isHome && address.indexOf(linkUrl) >= 0) {\n            resource.isActive = true;\n          }else if(linkUrl.indexOf('/ffan/') >=0 && window.location.href.indexOf('/ams') >=0 ){\n            resource.isActive = true;\n          }\n\n          var level = resource.levelStructure.split('.');\n\n          if (level[1] === '0') {\n            resource.subs = [];\n\n            for (var j = 0; j < resources.length; j++) {\n              var sub = resources[j];\n\n              if (sub.resourceType === 'menu' &&\n                sub.levelStructure.split('.')[0] === resource.levelStructure.split('.')[0]\n                && sub.levelStructure.split('.')[2] ==='0' &&\n                sub.levelStructure.split('.')[1] != '0'\n              ) {\n\n                sub.subs = [];\n                //for (var k = 0; k < resources.length; k++) {\n                //  var third = resources[k];\n                //  console.log('ss',third)\n                //  if (third.resourceType === 'menu' &&\n                //    third.parentLevelStructure === sub.levelStructure) {\n                //    sub.isLeaf = true;\n                //    sub.subs.push(third);\n                //  }\n                //}\n                // 兼容新菜单结构\n                sub.isLeaf = true;\n                resource.subs.push(sub);\n              }\n            }\n            console.log('123',sub)\n            menus.push(resource);\n          }\n        }\n      }\n    }\n\n    $('.main-sidebar').replaceWith(WUI.templates['site-menu']({\n      menus: menus,\n      isHome: isHome,\n      multiMenus: multiMenus\n    }));\n  };\n\n  var initConfigInfo = '';\n\n  var initSiteFooter = function (resp) {\n    $('.main-footer').replaceWith(WUI.templates['site-footer'](resp));\n  };\n\n  WUI.getResource = function (url, a) {\n    var la = a ? a : window.location.pathname;\n    url = la + url;\n    for (var i = 0; i < initConfigInfo.length; i++) {\n      var _link = initConfigInfo[i].linkUrl;\n      if (url == _link) {\n        var info = initConfigInfo[i];\n      }\n    }\n    return info\n  }\n\n  var initSystem = function () {\n    var url = '/' + WUI.config.system + '/web/v1/sso/getResources';\n    var data;\n\n    if (WUI.config.system === 'ams') {\n      url = '/ams/v1/sso/getResources';\n    } else if (WUI.config.system === 'order') {\n      // 工单系统获取菜单\n      url = '/app-coe-ordercenter/ordercenter/v1/sso/getResources';\n    }\n\n    WUI.ajax({\n      url: url,\n      method: 'POST',\n      data: data\n    }).done(function (resp) {\n      WUI.config.userName = resp.aasUserPrincipal.ssoUserName,\n        initSiteHeader(resp);\n      initSiteMenu(resp);\n      initSiteFooter(resp);\n      initConfigInfo = resp.aasUserPrincipal.aasUserResources.resources;\n      $.AdminLTE.init();\n      WUI.ready();\n    });\n  };\n\n  initSystem(options);\n};\n\nWUI.ready = WUI.ready || function () {\n    console.error('WUI: Please provide WUI.ready function.');\n  };\n\nWUI.typeItem = function (sub, info) {\n  var list = []\n  info.map(function (item) {\n    if (item.codeType == sub) {\n      list.push(item);\n    }\n  })\n  return list\n}\n\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiIiwic291cmNlcyI6WyJjb21tb24uanMiXSwic291cmNlc0NvbnRlbnQiOlsidmFyIERPTUFJTiA9ICcnO1xuXG52YXIgQVBJID0ge1xuICBTTUFSVF9ST1VUX0lORk86IERPTUFJTiArICcvdXBwL3dlYi92MS9yb3V0ZXMnLCAvLyDojrflj5blhajpg6jmmbrog73ot6/nlLHmjqXlj6NcbiAgU0VBUkNIX1NNQVJUX1JPVVQ6IERPTUFJTiArICcvdXBwL3dlYi92MS9mZWVSb3V0ZScsIC8v5p+l6K+i5LiA5p2h5pm66IO96Lev55SxXG4gIFNNQVJUX1JPVVQ6IERPTUFJTiArICcvdXBwL3dlYi92MS9yb3V0ZScsIC8v5pm66IO96Lev55SxXG4gIFNUQVRJQ19ST1VUX0lORk86IERPTUFJTiArICcvdXBwL3dlYi92MS9zdGF0aWNSb3V0ZXMnLCAvLyDojrflj5blhajpg6jpnZnmgIHot6/nlLHmjqXlj6NcbiAgU1RBVElDX1JPVVQ6IERPTUFJTiArICcvdXBwL3dlYi92MS9zdGF0aWNSb3V0ZScsIC8v6Z2Z5oCB6Lev55Sx5o6l5Y+jXG4gIEFMTF9UWVBFX0lORk86IERPTUFJTiArICcvdXBwL3dlYi92MS9hbGxDb2RldGFibGVzJywgLy/ojrflj5blhajpg6jnmoTnsbvlnovmjqXlj6NcbiAgUk9VVDogRE9NQUlOICsgJy91cHAvd2ViL3YxL3JvdXRlJywgLy/ot6/nlLFcbiAgQUNDT1VOVF9JTkZPOiBET01BSU4gKyAnL3VwcC93ZWIvdjEvYWNjb3VudHMnLCAvL+acrOaWuei0puaIt+S/oeaBr1xuICBDSEFOTkVMX0lORk86IERPTUFJTiArICcvdXBwL3dlYi92MS9jaGFubmVsQWJpbGl0eXMnLC8v5p+l6K+i6YCa6YGT5L+h5oGvXG4gIENIQU5ORUxfSVRFTTogRE9NQUlOICsgJy91cHAvd2ViL3YxL2NoYW5uZWxBYmlsaXR5JywvL+afpeivouWNleaMkemAmumBk+S/oeaBr1xuICBRVUVSWV9JTkZPX0NIQU5HRTogRE9NQUlOICsgJy91cHAvd2ViL3YxL3VwcFRvZG9zJywvL+afpeivouS/oeaBr+WPmOabtFxuICBRVUVSWV9JVEVNX0NIQU5ORUw6IERPTUFJTiArICcvdXBwL3dlYi92MS9tYWludGFpbkRldGFpbCcsIC8v5p+l6K+i5Y2V5p2h6YCa6YGT5L+h5oGvXG4gIFFVRVJZX0ZFRVNfSU5GTzogRE9NQUlOICsgJy91cHAvd2ViL3YxL2NoYW5uZWxGZWVzJywvL+afpeivouaJgOacieiuoei0ueS/oeaBr1xuICBRVUVSWV9GRUVfSVRFTTogRE9NQUlOICsgJy91cHAvd2ViL3YxL2NoYW5uZWxGZWUnLC8v5p+l6K+i5Y2V5Liq6K6h6LS55L+h5oGvXG4gIFNBVkVfQ0hBTkdFX0lORk86IERPTUFJTiArICcvdXBwL3dlYi92MS91cHBUb2RvJyAvL+S/neWtmOWuoeaguOS/oeaBr1xufTtcblxuQVBJLkRVTU1ZID0gJyc7XG5cbi8vdmFyIFdVSSA9IHdpbmRvdy5XVUkgfHwge307XG5cbldVSS5pbml0ID0gZnVuY3Rpb24gKG9wdGlvbnMpIHtcbiAgLy8gaW5pdCBnbG9iYWwgY29uZmlnXG4gIFdVSS5jb25maWcgPSBXVUkuY29uZmlnIHx8IHt9O1xuICBXVUkuY29uZmlnLnN5c3RlbSA9IG9wdGlvbnMuc3lzdGVtO1xuICBXVUkuY29uZmlnLmxvY2FsZSA9IG9wdGlvbnMubG9jYWxlIHx8ICd6aC1DTic7XG5cbiAgdmFyIGluaXRTaXRlSGVhZGVyID0gZnVuY3Rpb24gKHJlc3ApIHtcbiAgICBXVUkuU2l0ZUhlYWRlci5jcmVhdGUoe1xuICAgICAgJGVsOiAkKCcubWFpbi1oZWFkZXInKSxcbiAgICAgIG5hbWU6IHJlc3AuYWFzVXNlclByaW5jaXBhbC5zc29Vc2VyTmFtZSxcbiAgICAgIHJvbGVzOiByZXNwLmFhc1VzZXJQcmluY2lwYWwuYWFzVXNlclJlc291cmNlcy5yb2xlcyA/IHJlc3AuYWFzVXNlclByaW5jaXBhbC5hYXNVc2VyUmVzb3VyY2VzLnJvbGVzWzBdLnJvbGVOYW1lIDogJycsXG4gICAgICBMaXN0IDogcmVzcC5hYXNVc2VyUHJpbmNpcGFsLmFhc1VzZXJSZXNvdXJjZXMucmVzb3VyY2VzLFxuICAgICAgc3NvIDogcmVzcC5hYXNVc2VyUHJpbmNpcGFsXG4gICAgfSlcbiAgfTtcblxuICB2YXIgZmlsdGVyTWVudXMgPSBmdW5jdGlvbihyZXNvdXJjZXMpIHtcbiAgICB2YXIgbWVudXMgPSBbXTtcblxuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgcmVzb3VyY2VzLmxlbmd0aDsgaSsrKSB7XG4gICAgICB2YXIgcmVzb3VyY2UgPSByZXNvdXJjZXNbaV07XG5cbiAgICAgIGlmIChyZXNvdXJjZS5yZXNvdXJjZVR5cGUgPT09ICdtZW51Jykge1xuICAgICAgICBpZiAocmVzb3VyY2UuaXNMZWFmID09PSAnMCcpIHtcbiAgICAgICAgICByZXNvdXJjZS5saW5rVXJsID0gJ2phdmFzY3JpcHQ6dm9pZCgwKTsnO1xuICAgICAgICAgIHJlc291cmNlLnN1YnMgPSBbXTtcbiAgICAgICAgfVxuICAgICAgICBtZW51cy5wdXNoKHJlc291cmNlKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gbWVudXM7XG4gIH07XG5cbiAgdmFyIGZpbmRQYXJlbnQgPSBmdW5jdGlvbiAocmVzb3VyY2UsIHJlc291cmNlcykge1xuICAgIHZhciByZXN1bHQgPSBudWxsO1xuXG4gICAgaWYgKHJlc291cmNlLnBhcmVudExldmVsU3RydWN0dXJlKSB7XG4gICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHJlc291cmNlcy5sZW5ndGg7IGkrKykge1xuICAgICAgICBpZiAocmVzb3VyY2VzW2ldLmxldmVsU3RydWN0dXJlID09PSByZXNvdXJjZS5wYXJlbnRMZXZlbFN0cnVjdHVyZSkge1xuICAgICAgICAgIHJlc3VsdCA9IHJlc291cmNlc1tpXTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiByZXN1bHQ7XG4gIH1cblxuICB2YXIgaW5pdFNpdGVNZW51ID0gZnVuY3Rpb24gKHJlc3ApIHtcbiAgICB2YXIgbWVudXMgPSBbXTtcbiAgICB2YXIgbXVsdGlNZW51cyA9IGZhbHNlO1xuICAgIHZhciByZXNvdXJjZXMgPSByZXNwLmFhc1VzZXJQcmluY2lwYWwuYWFzVXNlclJlc291cmNlcy5yZXNvdXJjZXM7XG4gICAgLy8g6aaW6aG15piv5Li65a2Q57O757uf5Y2V54us5re75Yqg55qE77yM5rKh5pyJ5pS+5YWl5ZCO5Y+w5YGa566h55CGXG4gICAgdmFyIGlzSG9tZSA9IHdpbmRvdy5sb2NhdGlvbi5ocmVmLmluZGV4T2YoV1VJLmNvbmZpZy5zeXN0ZW0gKyAnL2hvbWUuaHRtbCcpID49IDA7XG5cbiAgICBpZiAoV1VJLmNvbmZpZy5zeXN0ZW0gPT09ICdvcmRlcicpIHtcbiAgICAgIC8vIOW3peWNleezu+e7n+Wbm+e6p+iPnOWNlee7k+aehOWmgu+8mjEuMi4zLjQuNSAo56ys5LiA5L2N5Li65a2Q57O757ufKVxuICAgICAgbXVsdGlNZW51cyA9IHRydWU7XG4gICAgICB2YXIgbWVudVJlc291cmNlcyA9IGZpbHRlck1lbnVzKHJlc291cmNlcyk7XG5cbiAgICAgIGZvciAodmFyIGluZGV4ID0gMDsgaW5kZXggPCBtZW51UmVzb3VyY2VzLmxlbmd0aDsgaW5kZXgrKykge1xuICAgICAgICB2YXIgbWVudVJlc291cmNlID0gbWVudVJlc291cmNlc1tpbmRleF07XG4gICAgICAgIHZhciBwYXJlbnQgPSBmaW5kUGFyZW50KG1lbnVSZXNvdXJjZSwgbWVudVJlc291cmNlcyk7XG5cbiAgICAgICAgaWYgKCFpc0hvbWUgJiYgd2luZG93LmxvY2F0aW9uLmhyZWYuaW5kZXhPZihtZW51UmVzb3VyY2UubGlua1VyKSA+PSAwKSB7XG4gICAgICAgICAgbWVudVJlc291cmNlLmlzQWN0aXZlID0gdHJ1ZTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChwYXJlbnQpIHtcbiAgICAgICAgICBwYXJlbnQuc3Vicy5wdXNoKG1lbnVSZXNvdXJjZSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgbWVudXMucHVzaChtZW51UmVzb3VyY2UpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIC8vIOe7n+S4gOezu+e7n+S6jOe6p+iPnOWNlee7k+aehOWmgu+8mjEuMi4zICjnrKzkuIDkvY3kuLrlrZDns7vnu58pXG4gICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHJlc291cmNlcy5sZW5ndGg7IGkrKykge1xuICAgICAgICB2YXIgcmVzb3VyY2UgPSByZXNvdXJjZXNbaV07XG4gICAgICAgIGlmIChyZXNvdXJjZS5saW5rVXJsICYmIHJlc291cmNlLmxpbmtVcmwuaW5kZXhPZigndHJhZGUtbW9uaXRvcicpID4gMCkge1xuICAgICAgICAgIHJlc291cmNlLm5ld1BhZ2UgPSB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIGlmIChyZXNvdXJjZS5yZXNvdXJjZVR5cGUgPT09ICdtZW51Jykge1xuICAgICAgICAgIHZhciBsaW5rVXJsID0gcmVzb3VyY2UubGlua1VybDtcbiAgICAgICAgICB2YXIgYWRkcmVzcyA9IHdpbmRvdy5sb2NhdGlvbi5ocmVmO1xuXG4gICAgICAgICAgaWYgKCFpc0hvbWUgJiYgYWRkcmVzcy5pbmRleE9mKGxpbmtVcmwpID49IDApIHtcbiAgICAgICAgICAgIHJlc291cmNlLmlzQWN0aXZlID0gdHJ1ZTtcbiAgICAgICAgICB9ZWxzZSBpZihsaW5rVXJsLmluZGV4T2YoJy9mZmFuLycpID49MCAmJiB3aW5kb3cubG9jYXRpb24uaHJlZi5pbmRleE9mKCcvYW1zJykgPj0wICl7XG4gICAgICAgICAgICByZXNvdXJjZS5pc0FjdGl2ZSA9IHRydWU7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgdmFyIGxldmVsID0gcmVzb3VyY2UubGV2ZWxTdHJ1Y3R1cmUuc3BsaXQoJy4nKTtcblxuICAgICAgICAgIGlmIChsZXZlbFsxXSA9PT0gJzAnKSB7XG4gICAgICAgICAgICByZXNvdXJjZS5zdWJzID0gW107XG5cbiAgICAgICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgcmVzb3VyY2VzLmxlbmd0aDsgaisrKSB7XG4gICAgICAgICAgICAgIHZhciBzdWIgPSByZXNvdXJjZXNbal07XG5cbiAgICAgICAgICAgICAgaWYgKHN1Yi5yZXNvdXJjZVR5cGUgPT09ICdtZW51JyAmJlxuICAgICAgICAgICAgICAgIHN1Yi5sZXZlbFN0cnVjdHVyZS5zcGxpdCgnLicpWzBdID09PSByZXNvdXJjZS5sZXZlbFN0cnVjdHVyZS5zcGxpdCgnLicpWzBdXG4gICAgICAgICAgICAgICAgJiYgc3ViLmxldmVsU3RydWN0dXJlLnNwbGl0KCcuJylbMl0gPT09JzAnICYmXG4gICAgICAgICAgICAgICAgc3ViLmxldmVsU3RydWN0dXJlLnNwbGl0KCcuJylbMV0gIT0gJzAnXG4gICAgICAgICAgICAgICkge1xuXG4gICAgICAgICAgICAgICAgc3ViLnN1YnMgPSBbXTtcbiAgICAgICAgICAgICAgICAvL2ZvciAodmFyIGsgPSAwOyBrIDwgcmVzb3VyY2VzLmxlbmd0aDsgaysrKSB7XG4gICAgICAgICAgICAgICAgLy8gIHZhciB0aGlyZCA9IHJlc291cmNlc1trXTtcbiAgICAgICAgICAgICAgICAvLyAgY29uc29sZS5sb2coJ3NzJyx0aGlyZClcbiAgICAgICAgICAgICAgICAvLyAgaWYgKHRoaXJkLnJlc291cmNlVHlwZSA9PT0gJ21lbnUnICYmXG4gICAgICAgICAgICAgICAgLy8gICAgdGhpcmQucGFyZW50TGV2ZWxTdHJ1Y3R1cmUgPT09IHN1Yi5sZXZlbFN0cnVjdHVyZSkge1xuICAgICAgICAgICAgICAgIC8vICAgIHN1Yi5pc0xlYWYgPSB0cnVlO1xuICAgICAgICAgICAgICAgIC8vICAgIHN1Yi5zdWJzLnB1c2godGhpcmQpO1xuICAgICAgICAgICAgICAgIC8vICB9XG4gICAgICAgICAgICAgICAgLy99XG4gICAgICAgICAgICAgICAgLy8g5YW85a655paw6I+c5Y2V57uT5p6EXG4gICAgICAgICAgICAgICAgc3ViLmlzTGVhZiA9IHRydWU7XG4gICAgICAgICAgICAgICAgcmVzb3VyY2Uuc3Vicy5wdXNoKHN1Yik7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCcxMjMnLHN1YilcbiAgICAgICAgICAgIG1lbnVzLnB1c2gocmVzb3VyY2UpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgICQoJy5tYWluLXNpZGViYXInKS5yZXBsYWNlV2l0aChXVUkudGVtcGxhdGVzWydzaXRlLW1lbnUnXSh7XG4gICAgICBtZW51czogbWVudXMsXG4gICAgICBpc0hvbWU6IGlzSG9tZSxcbiAgICAgIG11bHRpTWVudXM6IG11bHRpTWVudXNcbiAgICB9KSk7XG4gIH07XG5cbiAgdmFyIGluaXRDb25maWdJbmZvID0gJyc7XG5cbiAgdmFyIGluaXRTaXRlRm9vdGVyID0gZnVuY3Rpb24gKHJlc3ApIHtcbiAgICAkKCcubWFpbi1mb290ZXInKS5yZXBsYWNlV2l0aChXVUkudGVtcGxhdGVzWydzaXRlLWZvb3RlciddKHJlc3ApKTtcbiAgfTtcblxuICBXVUkuZ2V0UmVzb3VyY2UgPSBmdW5jdGlvbiAodXJsLCBhKSB7XG4gICAgdmFyIGxhID0gYSA/IGEgOiB3aW5kb3cubG9jYXRpb24ucGF0aG5hbWU7XG4gICAgdXJsID0gbGEgKyB1cmw7XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBpbml0Q29uZmlnSW5mby5sZW5ndGg7IGkrKykge1xuICAgICAgdmFyIF9saW5rID0gaW5pdENvbmZpZ0luZm9baV0ubGlua1VybDtcbiAgICAgIGlmICh1cmwgPT0gX2xpbmspIHtcbiAgICAgICAgdmFyIGluZm8gPSBpbml0Q29uZmlnSW5mb1tpXTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIGluZm9cbiAgfVxuXG4gIHZhciBpbml0U3lzdGVtID0gZnVuY3Rpb24gKCkge1xuICAgIHZhciB1cmwgPSAnLycgKyBXVUkuY29uZmlnLnN5c3RlbSArICcvd2ViL3YxL3Nzby9nZXRSZXNvdXJjZXMnO1xuICAgIHZhciBkYXRhO1xuXG4gICAgaWYgKFdVSS5jb25maWcuc3lzdGVtID09PSAnYW1zJykge1xuICAgICAgdXJsID0gJy9hbXMvdjEvc3NvL2dldFJlc291cmNlcyc7XG4gICAgfSBlbHNlIGlmIChXVUkuY29uZmlnLnN5c3RlbSA9PT0gJ29yZGVyJykge1xuICAgICAgLy8g5bel5Y2V57O757uf6I635Y+W6I+c5Y2VXG4gICAgICB1cmwgPSAnL2FwcC1jb2Utb3JkZXJjZW50ZXIvb3JkZXJjZW50ZXIvdjEvc3NvL2dldFJlc291cmNlcyc7XG4gICAgfVxuXG4gICAgV1VJLmFqYXgoe1xuICAgICAgdXJsOiB1cmwsXG4gICAgICBtZXRob2Q6ICdQT1NUJyxcbiAgICAgIGRhdGE6IGRhdGFcbiAgICB9KS5kb25lKGZ1bmN0aW9uIChyZXNwKSB7XG4gICAgICBXVUkuY29uZmlnLnVzZXJOYW1lID0gcmVzcC5hYXNVc2VyUHJpbmNpcGFsLnNzb1VzZXJOYW1lLFxuICAgICAgICBpbml0U2l0ZUhlYWRlcihyZXNwKTtcbiAgICAgIGluaXRTaXRlTWVudShyZXNwKTtcbiAgICAgIGluaXRTaXRlRm9vdGVyKHJlc3ApO1xuICAgICAgaW5pdENvbmZpZ0luZm8gPSByZXNwLmFhc1VzZXJQcmluY2lwYWwuYWFzVXNlclJlc291cmNlcy5yZXNvdXJjZXM7XG4gICAgICAkLkFkbWluTFRFLmluaXQoKTtcbiAgICAgIFdVSS5yZWFkeSgpO1xuICAgIH0pO1xuICB9O1xuXG4gIGluaXRTeXN0ZW0ob3B0aW9ucyk7XG59O1xuXG5XVUkucmVhZHkgPSBXVUkucmVhZHkgfHwgZnVuY3Rpb24gKCkge1xuICAgIGNvbnNvbGUuZXJyb3IoJ1dVSTogUGxlYXNlIHByb3ZpZGUgV1VJLnJlYWR5IGZ1bmN0aW9uLicpO1xuICB9O1xuXG5XVUkudHlwZUl0ZW0gPSBmdW5jdGlvbiAoc3ViLCBpbmZvKSB7XG4gIHZhciBsaXN0ID0gW11cbiAgaW5mby5tYXAoZnVuY3Rpb24gKGl0ZW0pIHtcbiAgICBpZiAoaXRlbS5jb2RlVHlwZSA9PSBzdWIpIHtcbiAgICAgIGxpc3QucHVzaChpdGVtKTtcbiAgICB9XG4gIH0pXG4gIHJldHVybiBsaXN0XG59XG4iXSwiZmlsZSI6ImNvbW1vbi5qcyIsInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9\n"],"sourceRoot":"/source/"}