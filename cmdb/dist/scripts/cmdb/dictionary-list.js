"use strict";var CMDB_API={queryDictionary:"/web/queryDictionary",add:"/web/dictionary/ex/addOrUpdate","delete":"/web/deleteDictionarys",update:"/web/dictionary/ex/addOrUpdate",column:"/web/dictionary/column",query:"/web/dictionary/query","export":"/web/excel/download/dictionary","import":"/web/excel/upload/dictionary"};META.code={label:"数据字典_code",required:!0,maxLength:30},META.content={label:"值",maxLength:30},META.table_name={label:"大类",type:"select",options:[]},META.column_name={label:"小类",type:"select",options:[]};var dictionaryJson={},EDIT_FIELDS=["code","table_name","column_name","content"],selectAry=["table_name","column_name"],createData=function(e){if(e.table_name){var a=e.table_name;META.column_name.options=[],$.each(dictionaryJson[a],function(e,a){var t={label:a,value:a};META.column_name.options.push(t)})}else{var a=META.table_name.options[0].value;META.column_name.options=[],$.each(dictionaryJson[a],function(e,a){var t={label:a,value:a};META.column_name.options.push(t)})}$.each(selectAry,function(a,t){for(var n=0;n<META[t].options.length;n++)META[t].options[n].label==e[t]?META[t].options[n].select=!0:META[t].options[n].select=!1}),WUI.ModalDialog.create({buttonHide:!0}),WUI.dataDialog.create({$el:$(".modal-body"),dialogPop:!0,meta:META,list:e,buttonHide:!1,onConfirm:submitData.bind(null,e),fields:EDIT_FIELDS})};submitData=function(e){var a=$.trim($("#html-dialog .modal-body input[name=code]").val()),t=$("#html-dialog .modal-body select[name=table_name]").val(),n=$("#html-dialog .modal-body select[name=column_name]").val(),o=$.trim($("#html-dialog .modal-body input[name=content]").val()),l=CMDB_API.add+"?table="+t+"&column="+n+"&value="+o+"&code="+a;e.id&&(l=CMDB_API.update+"?table="+t+"&column="+n+"&value="+o+"&code="+a+"&id="+e.id),WUI.ajax({url:DOMAIN.CMDB+l,method:"POST"}).then(function(e){$("#html-dialog, .modal-backdrop").remove(),$("body").removeClass("modal-open"),queryData({currentPage:1,pageSize:PAGE_SIZE})}).fail(function(e){$("#html-dialog, .modal-backdrop").remove()})},queryData=function(e){var a=function(a){a.setRequestHeader("pageNum",e.currentPage),a.setRequestHeader("pageLimit",e.pageSize),a.setRequestHeader("Authorization",getCookie("CMDB-TOKEN-TYPE")+" "+getCookie("CMDB-TOKEN"))};WUI.ajax({url:DOMAIN.CMDB+CMDB_API.query,method:"POST",jsonData:queryJson(),disableXSS:!0,beforeSend:a}).then(function(a){WUI.DataTable.create({$el:$(".data-table"),meta:META,fields:TABLE_FIELDS,list:a.list,operations:[{name:"编辑",callback:createData},{name:"删除",callback:deleteData}],groups:[{name:"批量删除",className:"btn btn-xs btn-danger",id:"btn-danger",callback:deleteData}]}),WUI.DataPaginator.create({$el:$(".data-paginator"),currentPage:e.currentPage-1,total:a.totalCount,pageSize:e.pageSize,onSwitchPage:function(a){queryData({currentPage:a+1,pageSize:e.pageSize})}})})},WUI.ready=function(){WUI.ajax({url:DOMAIN.CMDB+"/web/dictionary/ex/allTables",method:"POST"}).then(function(e){dictionaryJson=e,$.each(e,function(e){var a={label:e,value:e};META.table_name.options.push(a)})}).then(queryColumn),$(document).on("change","select[name=table_name]",function(){var e=$(this).val();$("select[name=column_name]").empty(),META.column_name.options=[];var a=[];$.each(dictionaryJson[e],function(e,t){var n={label:t,value:t};META.column_name.options.push(n),a.push('<option value="'+t+'">'+t+"</option>")}),$("select[name=column_name]").html(a.join(""))}),WUI.ContentHeader.create({$el:$(".content-header"),meta:[{name:"数据字典维护"}]})},$(function(){WUI.init({system:"cmdb"})});
//# sourceMappingURL=dictionary-list.js.map
