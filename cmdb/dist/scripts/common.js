function getCookie(e){var a=document.cookie.indexOf(e+"="),t=a+e.length+1;if(!a&&e!=document.cookie.substring(0,e.length))return null;if(a==-1)return null;var l=document.cookie.indexOf(";",t);return l==-1&&(l=document.cookie.length),unescape(document.cookie.substring(t,l))}function delCookie(e){var a=new Date;a.setTime(a.getTime()-1),document.cookie=e+"=; expires="+a.toGMTString()}var PAGE_SIZE=20,PAGE_SIZE_LABEL=10,DOMAIN={CMDB:""};7==window.location.href.indexOf("127.0.0.1")&&(DOMAIN.CMDB="http://cmdb.api.dev.wanda.com");var META={id:{label:"ID"},location:{label:"IDC",maxLength:30},rack:{label:"机柜",maxLength:30},rack_region:{label:"区域",maxLength:30},serial_number:{label:"SN",maxLength:30},cpu:{label:"CPU",maxLength:30},model:{label:"型号",maxLength:30},memory:{label:"内存",maxLength:30},raid:{label:"Raid 信息",maxLength:30},harddisk:{label:"硬盘",maxLength:30},manage_ip:{label:"管理IP",maxLength:30},vip:{label:"VIP",maxLength:30},typical_case:{label:"典型配置",maxLength:30},name:{label:"名称",maxLength:30},optional:{label:"其他",maxLength:30},net_name1:{label:"eth0",maxLength:30},net_ip1:{label:"eth0IP",maxLength:30},net_name2:{label:"eth1",maxLength:30},net_ip2:{label:"eth1IP",maxLength:30},net_name3:{label:"eth2",maxLength:30},net_ip3:{label:"eth2IP",maxLength:30},net_name4:{label:"eth3",maxLength:30},net_ip4:{label:"eth3IP",maxLength:30},net_name5:{label:"eth4",maxLength:30},net_ip5:{label:"eth4IP",maxLength:30},net_name6:{label:"eth5",maxLength:30},net_ip6:{label:"eth5IP",maxLength:30},net_name7:{label:"eth6",maxLength:30},net_ip7:{label:"eth6IP",maxLength:30},net_name8:{label:"eth7",maxLength:30},net_ip8:{label:"eth7IP",maxLength:30},net_name9:{label:"eth8",maxLength:30},net_ip9:{label:"eth8IP",maxLength:30},server_code:{label:"服务器_code",maxLength:30},label_key:{label:"标签键",maxLength:30},label_value:{label:"标签值",maxLength:30},version:{label:"版本",maxLength:30},hostname:{label:"主机名",maxLength:30},u_amount:{label:"U位",maxLength:30},rack_code:{label:"IDC_code",type:"select",options:[]},environment:{label:"版本",type:"select",options:[]},computer_amount:{label:"规格（U）",type:"select",options:[]},cloud_type:{label:"类型",type:"select",options:[]},type:{label:"接口",type:"select",options:[]},insure:{label:"保障",type:"select",options:[]},net_type1:{label:"type",type:"select",options:[]},net_type2:{label:"type",type:"select",options:[]},net_type3:{label:"type",type:"select",options:[]},net_type4:{label:"type",type:"select",options:[]},net_type5:{label:"type",type:"select",options:[]},net_type6:{label:"type",type:"select",options:[]},net_type7:{label:"type",type:"select",options:[]},net_type8:{label:"type",type:"select",options:[]},net_type9:{label:"type",type:"select",options:[]},os_family:{label:"OS family",type:"select",options:[]},os_version:{label:"OS version",type:"select",options:[]},status:{label:"状态",type:"select",options:[]},allocated:{label:"分配状态",type:"select",options:[]},purchase_time:{label:"采购时间",type:"dateCmdb",format:"yyyy-DD-MM",maxLength:30},arrival_time:{label:"到货时间",type:"dateCmdb",format:"yyyy-DD-MM",maxLength:30},stock_time:{label:"上架时间",type:"dateCmdb",format:"yyyy-DD-MM",maxLength:30},maintain_time_begin:{label:"维保开始时间",type:"dateCmdb",format:"yyyy-DD-MM",maxLength:30},maintain_time_end:{label:"维保结束时间",type:"dateCmdb",format:"yyyy-DD-MM",maxLength:30},created_time:{label:"创建时间",type:"dateCmdb",format:"yyyy-DD-MM",maxLength:30},updated_time:{label:"更新时间",type:"dateCmdb",format:"yyyy-DD-MM",maxLength:30},alloc_deadline:{label:"分配截止时间",type:"dateCmdb",format:"yyyy-DD-MM",maxLength:30},description:{label:"描述",maxLength:100}},SEARCH_TOOLS=[{label:"操作",options:[{rowHtml:'<a href="javascript:void(0);" onclick="exportData();">导出</a>'},{rowHtml:'<a href="javascript:void(0);" style="position:relative;">导入<input type="file" accept=".xls" onChange="importData(this);" style="position:absolute;left:0;top:0;bottom:0;opacity:0;width:100%;" /></a>'}]},{label:"工具",options:[{rowHtml:'<a href="http://10.214.124.55/zabbix/" target="_blank">zabbix</a>'},{rowHtml:'<a href="http://10.214.124.53:8080/" target="_blank">Jira</a>'},{rowHtml:'<a href="http://10.214.124.53:8090/" target="_blank">Confluence</a>'},{rowHtml:'<a href="http://10.214.124.53/itop/" target="_blank">Itop</a>'},{rowHtml:'<a href="http://10.214.66.75/" target="_blank">ELK</a>'},{rowHtml:'<a href="http://10.214.124.57/svnadmin/" target="_blank">Svn</a>'},{rowHtml:'<a href="http://10.214.124.57:8081/" target="_blank">GitLab</a>'},{rowHtml:'<a href="http://10.214.124.58:8080/" target="_blank">Jenkins</a>'},{rowHtml:'<a href="http://10.214.124.56:8081/nexus/" target="_blank">Nexus</a>'},{rowHtml:'<a href="https://10.214.124.59/" target="_blank">Ansible</a>'}]}],relationData=function(e){var a=[];e.length?$.each(e,function(e,t){a.push(t.id)}):a.push(e.id);var t=WUI.ModalDialog.create({title:"请确认",message:"是否确定删除数据？",onConfirm:function(){WUI.ajax({url:DOMAIN.CMDB+CMDB_API["delete"],method:"POST",jsonData:a}).then(function(e){t.hide(),queryData({currentPage:1,pageSize:PAGE_SIZE})})}})},submitData=function(e){var a=[],t=[],l={},n=$("#html-dialog .modal-body");$.each(n.find("input"),function(e,l){var i=n.find("input").eq(e);$.trim(i.val())&&(a.push(i.attr("name")),t.push($.trim(i.val())))}),$.each(n.find("select"),function(e,l){var i=n.find("select").eq(e);$.trim(i.val())&&(a.push(i.attr("name")),t.push(i.val()))}),$.each(n.find("textarea"),function(e,l){a.push(n.find("textarea").eq(e).attr("name")),t.push(n.find("textarea").eq(e).val())});for(var i=0;i<a.length;i++)l[a[i]]=t[i];var o=CMDB_API.add;e.id&&(o=CMDB_API.update,l.id=e.id),WUI.ajax({url:DOMAIN.CMDB+o,method:"POST",jsonData:l}).then(function(e){$("#html-dialog, .modal-backdrop").remove(),$("body").removeClass("modal-open"),queryData({currentPage:1,pageSize:PAGE_SIZE})}).fail(function(e){$("#html-dialog, .modal-backdrop").remove()})},deleteData=function(e){var a=[];e.length?$.each(e,function(e,t){a.push(t.id)}):a.push(e.id);var t=WUI.ModalDialog.create({title:"请确认",message:"是否确定删除数据？",onConfirm:function(){WUI.ajax({url:DOMAIN.CMDB+CMDB_API["delete"],method:"POST",jsonData:a}).then(function(e){t.hide(),queryData({currentPage:1,pageSize:PAGE_SIZE})})}})},labelDataJson={},labelDataHtml=function(e){var a=[];a.push("    <h4>已选择标签<span>清除全部</span></h4>"),$.each(e,function(t){a.push('    <p class="active"><span></span>'+t+"</p>"),a.push("    <ul>");for(var l=0;l<e[t].length;l++)a.push("      <li>"+e[t][l]+"</li>");a.push("    </ul>")}),$(".modal-body .data-label").html(a.join("")),$(".modal-body .data-label p").click(function(){var e=$(this);e.hasClass("active")?e.removeClass("active"):e.addClass("active")}),$(".modal-body .data-label > h4 span").click(function(){labelDataJson={},labelDataHtml(labelDataJson),$(".modal-body .data-table input[type=checkbox]").prop("checked",!1)})},labelColumnTableFields=[],labelData=function(e){var a=e[0].table,t=[];$.each(e,function(e,a){t.push(a.id)}),WUI.ajax({url:DOMAIN.CMDB+"/web/label/ex/queryLabel?table="+a+"&ids="+t.join(","),method:"POST"}).then(function(e){labelDataJson=e,WUI.ModalDialog.create({title:"标签",onConfirm:submitLabelData.bind(this,a,t)});var l=[];l.push('<div class="row">'),l.push('  <div class="col-lg-9 col-md-9 col-sm-9">'),l.push('    <div class="data-search"></div>'),l.push('    <div class="data-table"></div>'),l.push('    <div class="data-paginator"></div>'),l.push("  </div>"),l.push('  <div class="col-lg-3 col-md-3 col-sm-3 data-label">'),l.push("  </div>"),l.push("</div>"),$(".modal-body").html(l.join("")),labelDataHtml(labelDataJson)}).then(function(){WUI.ajax({url:DOMAIN.CMDB+"/web/label/column",method:"POST"}).then(function(e){labelColumnTableFields=e.showColumnName,WUI.DataSearch.create({$el:$(".modal-body .data-search"),meta:e,queryButton:"查询",onFilter:function(e){labelQueryData($.extend(e,{currentPage:1,pageSize:PAGE_SIZE_LABEL}))}}),labelQueryData({currentPage:1,pageSize:PAGE_SIZE_LABEL})})})},labelQueryData=function(e){var a=function(a){a.setRequestHeader("pageNum",e.currentPage),a.setRequestHeader("pageLimit",e.pageSize),a.setRequestHeader("Authorization",getCookie("CMDB-TOKEN-TYPE")+" "+getCookie("CMDB-TOKEN"))};WUI.ajax({url:DOMAIN.CMDB+"/web/label/query",method:"POST",jsonData:queryJson(!0),disableXSS:!0,beforeSend:a}).then(function(a){WUI.DataTable.create({$el:$(".modal-body .data-table"),meta:META,fields:labelColumnTableFields,list:a.list,groups:[{name:"标签",className:"btn btn-xs btn-success",callback:labelData}]}),WUI.DataPaginator.create({$el:$(".modal-body .data-paginator"),currentPage:e.currentPage-1,total:a.totalCount,pageSize:e.pageSize,onSwitchPage:function(a){labelQueryData({currentPage:a+1,pageSize:e.pageSize})}}),$.each($(".modal-body tbody tr"),function(e,a){var t=$(this),l=t.find("td").eq(1).text(),n=t.find("td").eq(2).text();labelDataJson[l]&&$.each(labelDataJson[l],function(e,a){labelDataJson[l][e]==n&&t.find("input[type=checkbox]").prop("checked",!0)})}),$(".modal-body .data-table input[type=checkbox]").click(function(){var e=$(this),a=e.parents("tr"),t=a.find("td").eq(1).text(),l=a.find("td").eq(2).text();if(e.is(":checked"))if(labelDataJson[t]){var n=!1;$.each(labelDataJson[t],function(e,a){if(l==a)return n=!0,!0}),n||labelDataJson[t].push(l)}else labelDataJson[t]=[l];else 1==labelDataJson[t].length?delete labelDataJson[t]:$.each(labelDataJson[t],function(e,a){if(l==a)return labelDataJson[t].splice(e,1),!0});labelDataHtml(labelDataJson)})})},submitLabelData=function(e,a){var t=[];$.each(labelDataJson,function(e,a){$.each(a,function(a,l){var n=e+":"+l;t.push(n)})}),WUI.ajax({url:DOMAIN.CMDB+"/web/label/ex/addLabel?table="+e+"&ids="+a.join(",")+"&labels="+t.join(","),method:"POST"}).then(function(e){$("#html-dialog, .modal-backdrop").remove(),$("body").removeClass("modal-open"),WUI.alert.create({message:"标签修改成功",success:!0}),WUI.ajax({url:DOMAIN.CMDB+CMDB_API.column,method:"POST"}).then(function(e){var a=[];e.data[0].dictionaryValues.length>0?(a.push('<div class="data-search-condition data-search-checkbox">'),$.each(e.data[0].dictionaryValues,function(e,t){a.push('<label><input type="checkbox" name="_label_">'+t+"</label>")}),a.push("</div>")):(a.push('<div class="data-search-condition data-search-text">'),a.push('  <input class="form-control" type="text" name="_label_" placeholder="标签">'),a.push("</div>")),$(".data-search-basic li").eq(0).find(".data-search-condition").remove(),$(".data-search-basic li").eq(0).append(a.join("")).find("button > p > span").text(""),queryData({currentPage:1,pageSize:PAGE_SIZE})})}).fail(function(e){$("#html-dialog, .modal-backdrop").remove()})},queryJson=function(e){var a={data:[]};if(e)var t=$('.modal-body .data-search > ul:not(".data-tools") > li:not(".data-search-else")');else var t=$('.box > .data-search > ul:not(".data-tools") > li:not(".data-search-else")');return $.each(t,function(e,l){var n={paths:[],tableName:"",columnName:""};n.paths=t.eq(e).attr("data-paths").split(","),n.tableName=t.eq(e).attr("data-tableName"),n.columnName=t.eq(e).attr("data-columnName");var i=t.eq(e).find(".data-search-condition");if(i.hasClass("data-search-text")){var o=i.find("input");if(!$.trim(o.val()))return!0;n.value=$.trim(o.val())}else if(i.hasClass("data-search-checkbox")){var o=i.find("input:checked");if(!o.length)return!0;n.values=[],$.each(o,function(e,a){n.values.push(o.eq(e).parent().text())})}else if(i.hasClass("data-search-fromTo")){var o=i.find("input");if(!$.trim(o.eq(0).val())&&!$.trim(o.eq(1).val()))return!0;n.from=$.trim(o.eq(0).val()),n.to=$.trim(o.eq(1).val())}else{var o=t.eq(e).find("input");if(!$.trim(o.val()))return!0;n.value=$.trim(o.val())}a.data.push(n)}),a},TABLE_FIELDS=[],queryData=function(e){var a=function(a){a.setRequestHeader("pageNum",e.currentPage),a.setRequestHeader("pageLimit",e.pageSize),a.setRequestHeader("Authorization",getCookie("CMDB-TOKEN-TYPE")+" "+getCookie("CMDB-TOKEN"))};WUI.ajax({url:DOMAIN.CMDB+CMDB_API.query,method:"POST",jsonData:queryJson(),disableXSS:!0,beforeSend:a}).then(function(a){WUI.DataTable.create({$el:$(".data-table"),meta:META,fields:TABLE_FIELDS,list:a.list,operations:[{name:"关系",callback:relationData},{name:"编辑",callback:createData},{name:"删除",callback:deleteData}],groups:[{name:"标签",className:"btn btn-xs btn-success",id:"btn-success",callback:labelData},{name:"下载",className:"btn btn-xs btn-warning",id:"btn-warning",callback:downloadData},{name:"批量删除",className:"btn btn-xs btn-danger",id:"btn-danger",callback:deleteData}]}),WUI.DataPaginator.create({$el:$(".data-paginator"),currentPage:e.currentPage-1,total:a.totalCount,pageSize:e.pageSize,onSwitchPage:function(a){queryData({currentPage:a+1,pageSize:e.pageSize})}})})},downloadData=function(e){var a={data:[{paths:[e[0].table],tableName:e[0].table,columnName:"id",values:[]}]};$.each(e,function(e,t){a.data[0].values.push(t.id)});var t=$("<form>");t.attr("id","exportDataForm"),t.attr("style","display:none"),t.attr("target","_blank"),t.attr("method","post"),t.attr("action",DOMAIN.CMDB+CMDB_API["export"]);var l=$("<input>");l.attr("type","hidden"),l.attr("name","jsonString"),l.attr("value",JSON.stringify(a)),$("body").append(t),t.append(l),t.submit(),$("#exportDataForm").remove()},exportData=function(){var e=$("<form>");e.attr("id","exportDataForm"),e.attr("style","display:none"),e.attr("target","_blank"),e.attr("method","post"),e.attr("action",DOMAIN.CMDB+CMDB_API["export"]);var a=$("<input>");a.attr("type","hidden"),a.attr("name","jsonString"),a.attr("value",JSON.stringify(queryJson())),$("body").append(e),e.append(a),e.submit(),$("#exportDataForm").remove()},importData=function(e){WUI.loading.create();var a=e.files[0],t=new FormData;t.append("file",a),$.ajax({url:DOMAIN.CMDB+CMDB_API["import"],data:t,method:"POST",dataType:"json",cache:!1,contentType:!1,processData:!1,beforeSend:function(e){e.setRequestHeader("Authorization",getCookie("CMDB-TOKEN-TYPE")+" "+getCookie("CMDB-TOKEN"))}}).then(function(e){$("#loadingPop").remove(),l(),"500"===e.errorCode?WUI.alert.create({message:e.message,fail:!0}):(WUI.alert.create({message:"导入成功",success:!0}),queryData({currentPage:1,pageSize:PAGE_SIZE}))}).fail(function(e){$("#loadingPop").remove(),l(),WUI.alert.create({message:"导入失败",fail:!0})});var l=function(){e.outerHTML?e.outerHTML=e.outerHTML:e.value=""}},queryDictionary=function(e){WUI.ajax({url:DOMAIN.CMDB+CMDB_API.queryDictionary,method:"POST",jsonData:{table_name:e}}).then(function(e){$.each(e.list,function(e,a){var t={label:a.content,value:a.content};META[a.column_name].options.push(t)})}).then(queryColumn)},queryColumn=function(){WUI.ajax({url:DOMAIN.CMDB+CMDB_API.column,method:"POST"}).then(function(e){TABLE_FIELDS=e.showColumnName,WUI.DataSearch.create({$el:$(".content-wrapper .data-search"),meta:e,searchTools:SEARCH_TOOLS?SEARCH_TOOLS:[],queryButton:"查询",onFilter:function(e){queryData($.extend(e,{currentPage:1,pageSize:PAGE_SIZE}))},addButton:"新增",addFunc:createData}),queryData({currentPage:1,pageSize:PAGE_SIZE})})};WUI.init=function(e){WUI.config=WUI.config||{},WUI.config.system=e.system,WUI.config.locale=e.locale||"zh-CN";var a=function(e){WUI.SiteHeader.create({$el:$(".main-header"),name:e.aasUserPrincipal.ssoUserName,roles:e.aasUserPrincipal.aasUserResources.roles[0].roleName,cmdbQuick:!0})},t=function(e){for(var a=[],t=0;t<e.length;t++){var l=e[t];"menu"===l.resourceType&&(l.isLeaf||(l.subs=[]),a.push(l))}return a},l=function(e,a){var t=null;if(e.parentLevelStructure)for(var l=0;l<a.length;l++)if(a[l].levelStructure===e.parentLevelStructure){t=a[l];break}return t},n=function(e){var a=[],n=e.aasUserPrincipal.aasUserResources.resources,i=window.location.href.indexOf(WUI.config.system+"/home.html")>=0;if("order"===WUI.config.system)for(var o=t(n),r=0;r<o.length;r++){var s=o[r],c=l(s,o);!i&&window.location.href.indexOf(s.linkUr)>=0&&(s.isActive=!0),c?c.subs.push(s):a.push(s)}else for(var u=0;u<n.length;u++){var d=n[u];if(d.linkUrl&&d.linkUrl.indexOf("trade-monitor")>0&&(d.newPage=!0),"menu"===d.resourceType){var m=d.linkUrl,p=window.location.href;!i&&p.indexOf(m)>=0&&(d.isActive=!0);var h=d.levelStructure.split(".");if("0"===h[1]){d.subs=[];for(var b=0;b<n.length;b++){var f=n[b];if("menu"===f.resourceType&&f.parentLevelStructure===d.levelStructure){f.subs=[];for(var y=0;y<n.length;y++){var v=n[y];"menu"===v.resourceType&&v.parentLevelStructure===f.levelStructure&&(f.isLeaf=!0,f.subs.push(v))}f.isLeaf=!0,d.subs.push(f)}}a.push(d)}}}var g=[{resourceDisplayName:"CMDB",subs:[{resourceDisplayName:"配置项维护",subs:[{resourceDisplayName:"位置",linkUrl:"/cmdb/idc-list.html",isActive:window.location.href.indexOf("/cmdb/idc-list.html")>1,isLeaf:!0},{resourceDisplayName:"服务器",linkUrl:"/cmdb/serve-list.html",isActive:window.location.href.indexOf("/cmdb/serve-list.html")>1,isLeaf:!0},{resourceDisplayName:"虚拟机",linkUrl:"/cmdb/vm-list.html",isActive:window.location.href.indexOf("/cmdb/vm-list.html")>1,isLeaf:!0},{resourceDisplayName:"网络设备",linkUrl:"/cmdb/device-list.html",isActive:window.location.href.indexOf("/cmdb/device-list.html")>1,isLeaf:!0},{resourceDisplayName:"应用",linkUrl:"/cmdb/project-list.html",isActive:window.location.href.indexOf("/cmdb/project-list.html")>1,isLeaf:!0},{resourceDisplayName:"关系"}]},{resourceDisplayName:"配置项管理",subs:[{resourceDisplayName:"配置项查询",linkUrl:"/cmdb/quick-query.html",isActive:window.location.href.indexOf("/cmdb/quick-query.html")>1,isLeaf:!0}]}]},{resourceDisplayName:"通知管理",subs:[{resourceDisplayName:"标签"},{resourceDisplayName:"配置项"}]},{resourceDisplayName:"系统管理",subs:[{resourceDisplayName:"标签",linkUrl:"/cmdb/label-list.html",isActive:window.location.href.indexOf("/cmdb/label-list.html")>1,isLeaf:!0},{resourceDisplayName:"数据字典",linkUrl:"/cmdb/dictionary-list.html",isActive:window.location.href.indexOf("/cmdb/dictionary-list.html")>1,isLeaf:!0},{resourceDisplayName:"用户",linkUrl:"/cmdb/people-list.html",isActive:window.location.href.indexOf("/cmdb/people-list.html")>1,isLeaf:!0}]}];$(".main-sidebar").replaceWith(WUI.templates["site-menu"]({menus:g,isHome:i})),$(".sidebar-menu li").click(function(e){var a=$(this);a.hasClass("active")?a.removeClass("active"):($(".sidebar-menu li").removeClass("active"),a.addClass("active").parents("li").addClass("active"),a.parents(".treeview-menu").prev().addClass("active")),e.stopPropagation()});var D=window.location.href,x=D.split("/")[0]+"//"+D.split("/")[2],_=D.slice(x.length).split("?")[0];$.each($(".sidebar-menu a"),function(){var e=$(this),a=e.attr("href");if(a==_)return e.parents("li").addClass("active"),e.parents(".treeview-menu").prev("li").addClass("active"),!1})},i="",o=function(e){$(".main-footer").replaceWith(WUI.templates["site-footer"](e))};WUI.getResource=function(e,a){var t=a?a:window.location.pathname;e=t+e;for(var l=0;l<i.length;l++){var n=i[l].linkUrl;if(e==n)var o=i[l]}return o};var r=function(){var e={aasUserPrincipal:{aasUserResources:{resources:[],roles:[{roleName:"Administrator"}]},ssoUserName:getCookie("CMDB-USERNAME")}};WUI.config.userName=e.aasUserPrincipal.ssoUserName,a(e),n(e),o(e),i=e.aasUserPrincipal.aasUserResources.resources,$.AdminLTE.init(),WUI.ready(),$(".navbar-cmdb-quick input").focus(),$(".navbar-cmdb-quick input").keyup(function(e){var a=$.trim($(this).val());13==e.keyCode&&(window.location.href="/cmdb/quick-query.html?key="+a)})};r(e)},WUI.ready=WUI.ready||function(){console.error("WUI: Please provide WUI.ready function.")},WUI.typeItem=function(e,a){var t=[];return a.map(function(a){a.codeType==e&&t.push(a)}),t};
//# sourceMappingURL=common.js.map
